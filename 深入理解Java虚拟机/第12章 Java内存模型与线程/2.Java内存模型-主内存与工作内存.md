## 12.3 硬件的效率和一致性
　　Java虚拟机规范中试图定义一种Java内存模型来屏蔽掉各种硬件和操作系统的内存访问差异，以实现让Java程序在各种平台下都能达到一致的内存访问效果。定义Java内存模型并非一件容易的事情，这个模型必须定义的足够严谨，才能让Java的并发内存访问操作不会产生歧义；但是，也必须定义的足够宽松，使得虚拟机的实现有足够的自由空间去利用硬件的各种特性来获取更好的执行速度。

### 12.3.1 主内存与工作内存
　　Java内存模型的主要目标是定义程序中各个变量的访问规则，即在虚拟机中将变量存储到内存和从内存中取出变量这样的底层细节。此处的变量与Java编程中所说的变量有所区别，它包括了实例字段，静态字段和构成数组对象的元素，但不包括局部变量与方法参数，因为后者是线程是有的，不会被共享，自然就不会存在竞争问题。

　　Java内存模型规定了所有的变量都存储在主内存中（此处的主内存仅仅是虚拟机内存的一部分），每条线程还有自己的工作内存。线程工作内存中保存了被该线程使用到的变量的主内存副本拷贝，线程对变量的所有的操作都必须在工作内存中进行，而不能直接读写主内存中的变量。不同的线程之间也服务直接访问对方工作内存中的变量，线程间的变量值的传递均需要主内存来完成，线程、主内存、工作内存三者的交互关系如图12-2所示。

![线程、主内存、工作内存三者的交互关系]()
